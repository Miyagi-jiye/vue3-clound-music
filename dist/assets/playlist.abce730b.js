import{B as h}from"./index.fef9ee66.js";import{c as g,d as p,e as P,f as o,g as f,h as L}from"./login.d66f7d5f.js";import{v as r}from"./vue.73cea66e.js";const x=h("playlist",{state:()=>({playlist:{trackIds:[],tracks:[],creator:{}},comments:{comments:[],hotComments:[],total:0},commentParams:{limit:20,offset:1},commentMoreParams:{limit:20,offset:1},currentPlayMusic:{id:1,name:"Vue.js \u6E10\u8FDB\u5F0FJavaScript \u6846\u67B6",ar:[{id:12345,name:"\u5C24\u96E8\u6EAA"}],al:{id:12345,name:"\u4E13\u8F91",picUrl:r},dt:0},toPlayList:[{id:1,name:"Vue.js \u6E10\u8FDB\u5F0FJavaScript \u6846\u67B6",ar:[{id:12345,name:"\u5C24\u96E8\u6EAA"}],al:{id:12345,name:"\u4E13\u8F91",picUrl:r},dt:0}],lyric:[],songs:{},songsAll:[],audioStatus:!1,audioCurrentTime:0,audioDuration:0,progressStatus:0,playMode:"playOnce",playSpeed:1,volume:50}),getters:{currentPlayID(s){return s.currentPlayMusic.id},playListCount(s){return s.toPlayList.length},thisIndex(s){return s.toPlayList.findIndex(t=>t.id===s.currentPlayMusic.id)},nextSong(s){const{thisIndex:t,playListCount:i}=this;if(t===i-1)return s.toPlayList.at(0);{const n=t+1;return s.toPlayList[n]}},prevSong(s){const{thisIndex:t}=this;if(t===0)return s.toPlayList.at(-1);{const i=t-1;return s.toPlayList[i]}}},actions:{async get_songDetail(s){const t=await g(s);this.songs=t.data.songs[0],console.log("\u83B7\u53D6\u5355\u9996\u6B4C\u66F2\u8BE6\u60C5",t.data),this.change_playMusic(this.songs),this.push_toPlayList(this.songs)},async get_songDetailAll(s){const t=await p(this.playlist.trackIds.join(","));this.songsAll=t.data.songs,this.playlist.tracks=this.songsAll,console.log("\u83B7\u53D6\u5168\u90E8\u6B4C\u66F2\u8BE6\u60C5",t.data)},async get_songlistDetail(s){const t=await P(s);this.playlist=t.data.playlist,this.playlist.trackIds=t.data.playlist.trackIds.map(i=>Number(i.id)),console.log("\u83B7\u53D6\u6B4C\u5355\u8BE6\u60C5",t.data)},async get_songlistComment(s){const t=await o(s,this.commentParams);this.comments=t.data,console.log("\u83B7\u53D6\u6B4C\u5355\u8BC4\u8BBA",t.data)},async get_songlistCommentMore(s){const t=await o(s,this.commentMoreParams);t.data.more!=!1&&(t.data.comments.forEach(i=>{this.comments.comments.push(i)}),console.log("\u83B7\u53D6\u66F4\u591A\u6B4C\u5355\u8BC4\u8BBA",t.data))},async get_musicUrl(s){const t=await f(s);return console.log("\u83B7\u53D6\u6B4C\u66F2url",t.data),t.data},push_musicToPlayList(){if(this.toPlayList=this.playlist.tracks,this.toPlayList.length!==0)this.change_playMusic(this.toPlayList[0]);else return!1},async change_playMusic(s){if(this.currentPlayMusic.id!==s.id)await this.get_lyric(s.id),this.currentPlayMusic=s;else return!1},push_toPlayList(s){if(this.toPlayList.some(t=>t.id===s.id)===!0)return!1;this.toPlayList.push(s)},clear_toPlayList(){this.toPlayList=[{id:1,name:"Vue.js \u6E10\u8FDB\u5F0FJavaScript \u6846\u67B6",ar:[{id:12345,name:"\u5C24\u96E8\u6EAA"}],al:{id:12345,name:"\u4E13\u8F91",picUrl:r},dt:0}],this.currentPlayMusic={id:1,name:"Vue.js \u6E10\u8FDB\u5F0FJavaScript \u6846\u67B6",ar:[{id:12345,name:"\u5C24\u96E8\u6EAA"}],al:{id:12345,name:"\u4E13\u8F91",picUrl:r},dt:0}},delete_toPlayList(s){this.toPlayList.splice(this.toPlayList.findIndex(t=>t.id==s),1)},pre_music(){if(this.toPlayList==[]){console.log("\u7A7A\u6570\u7EC4");return}this.currentPlayMusic=this.prevSong,this.get_lyric(this.currentPlayMusic.id)},next_music(){if(this.toPlayList==[]){console.log("\u7A7A\u6570\u7EC4");return}this.currentPlayMusic=this.nextSong,this.get_lyric(this.currentPlayMusic.id)},async get_lyric(s){try{const t=await L(s);this.lyric=this.parse_lyric(t.data.lrc.lyric),console.log("\u83B7\u53D6\u6B4C\u8BCD",t.data)}catch(t){console.log(t)}},handle_lyric(s){let t=[];return t=s.split(/\s*\n*\[.*?\]\s*/).filter(i=>!!i),t},parse_lyric(s){let t=s.split(`
`),i=/\[\d*:\d*\.\d*\]/g,n=/\[\d*/i,c=/\:\d*\.\d*/i,l=[];return t.filter(a=>!!a),t.forEach(function(a){let e=a.match(i);if(!e)return;e=e[0];let u=e.match(n)[0].substring(1),y=e.match(c)[0].substring(1),d=parseInt(u)*60+parseFloat(y),m=a.replace(i,"").trim();l.push({time:Number(d.toFixed(3)),lyric:m,next:0})}),l.forEach((a,e)=>{e==l.length-1?a.next=a.time+999:a.next=l[e+1].time}),console.log("\u683C\u5F0F\u5316\u540E\u7684\u6B4C\u8BCD",l),l}}});export{x as u};
